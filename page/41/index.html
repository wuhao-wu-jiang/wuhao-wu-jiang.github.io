<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="WOW">
<meta property="og:url" content="http://example.com/page/41/index.html">
<meta property="og:site_name" content="WOW">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="WOW">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/41/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>WOW</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">WOW</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">你生之前悠悠千載已逝<br>未來還會有千年沉寂的期待</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/29/Weak%20duality,%20Complementary%20Slackness,%20Strong%20Duality/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="WOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WOW">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/29/Weak%20duality,%20Complementary%20Slackness,%20Strong%20Duality/" class="post-title-link" itemprop="url">Dual Program, Weak Duality, Complementary Slackness, Strong Duality</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-29 19:47:54" itemprop="dateCreated datePublished" datetime="2020-01-29T19:47:54-05:00">2020-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-01 07:39:02" itemprop="dateModified" datetime="2022-04-01T07:39:02-04:00">2022-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Every linear program can be converted into Canonical form <span
class="math display">\[
    \begin{array}{lr}
        \max &amp; c^T x \\
        \text{s.t. } &amp; Ax \le b \\
            &amp;x \ge 0
    \end{array}
\]</span> for some <span class="math inline">\(c, x \in
\mathbb{R}^n\)</span>, <span class="math inline">\(A \in \mathbb{R}^{m
\times n}\)</span> and <span class="math inline">\(b \in
\mathbb{R}^m\)</span>.</p>
<h1 id="dual-program-and-weak-duality">Dual Program and Weak
Duality</h1>
<p>Next, we try to construct an upper bound for the optimal solution of
this optimization problem, based on its linear constraints.</p>
<p>If <span class="math inline">\(y \in \mathbb{R}^m\)</span> and <span
class="math inline">\(y \ge 0\)</span>, then <span
class="math inline">\(y^T (Ax)\)</span> is called a <em>conic
combination</em> of the constraints. It holds that <span
class="math display">\[
    y^T (Ax) \le y^T b.
\]</span></p>
<p>If <span class="math inline">\(y\)</span> further satisfies the
constraint <span class="math display">\[
    c^T \le y^T A,
\]</span></p>
<p>combining with the fact that <span class="math inline">\(x \ge
0\)</span>, we get <span class="math display">\[
    c^T x \le (y^T A) x = y^T (Ax) \le y^T b.
\]</span></p>
<p>Hence <span class="math inline">\(y^T b\)</span> is an upper bound of
the optimal value of the original program. We want the bound to be as
tight as possible. This motivates another linear program: <span
class="math display">\[
    \begin{array}{lr}
        \min            &amp; y^T b \\
        \text{s.t. }    &amp; y^T A \ge c^T \\
                        &amp; y \ge 0
    \end{array}
\]</span></p>
<p>We call the original program the <strong>primal</strong> and the
derived program its <strong>dual</strong>. The philosophy behind the
dual construction is to combine the primal constraints to obtain a bound
of its optimal value.</p>
<blockquote>
<p><strong>Corollary.</strong> If the primal is unbounded, then the dual
is infeasible. If the dual is unbounded, then the primal is
infeasible.</p>
</blockquote>
<p>In general, the primal may not be given in Canonical form and can be
formulated as</p>
<p><span class="math display">\[
    \begin{array}{lr}
        \max &amp; c^T x + \bar c^T \bar x + \hat c^T \hat x \\
        \text{s.t. } &amp; Ax + \bar A \bar x + \hat A \hat x \le b \\
        &amp; Bx + \bar B \bar x + \hat B \hat x =  \bar b \\
        &amp; Cx + \bar C \bar x + \hat C \hat x \ge \hat b \\
        &amp; x \ge 0 \\
        &amp; \hat x \le 0
    \end{array}
\]</span></p>
<p>Note that the <span class="math inline">\(\bar x\)</span>'s are
unconstrained variables. Driven by the same philosophy, we hope to
derive an upper bound by using the constraints: <span
class="math display">\[
    \begin{aligned}
        c^T x + \bar c^T \bar x + \hat c^T \hat x
            &amp; \le y^T (Ax + \bar A \bar x + \hat A \hat x) \\
            &amp; + \bar y^T (Bx + \bar B \bar x + \hat B \hat x) \\
            &amp; + \hat y^T (Cx + \bar C \bar x + \hat C \hat x) \\
            &amp;\le y^T b + \bar y^T \bar b + \hat y^T \hat b
    \end{aligned}
\]</span></p>
<ol type="1">
<li><p>To guarantee the second inequality, we require that</p>
<ul>
<li><p><span class="math inline">\(y^T \ge 0\)</span> (since the
constraint <span class="math inline">\(Ax + \bar A \bar x + \hat A \hat
x \le b\)</span> holds),</p></li>
<li><p><span class="math inline">\(\bar y^T\)</span> be unconstrained
(since the constraint <span class="math inline">\(Bx + \bar B \bar x +
\hat B \hat x = \bar b\)</span> holds), and</p></li>
<li><p><span class="math inline">\(\hat y^T \le 0\)</span> (since the
constraint <span class="math inline">\(Cx + \bar C \bar x + \hat C \hat
x \ge \hat b\)</span> holds).</p></li>
</ul>
<p>We see that the types of constraints in the primal determine the
signs of variables in the dual.</p></li>
<li><p>The reverse is also true: the constraints in the dual are
determined the signs of variables in the primal. The first inequality
implies that (by proper rearranging): <span class="math display">\[
     \begin{aligned}
         c^T x + \bar c^T \bar x + \hat c^T \hat x
             &amp; \le (y^T A + \bar y^T B + \hat y^T C)x \\
             &amp; + (y^T \bar A + \bar y^T \bar B + \hat y^T \bar C)
\bar x \\
             &amp; + (y^T \hat A + \bar y^T \hat B + \hat y^T \hat C)
\hat x
     \end{aligned}
\]</span></p>
<p>As <span class="math inline">\(x \ge 0\)</span>, <span
class="math inline">\(\bar x\)</span> unconstrained and <span
class="math inline">\(\hat x \le 0\)</span>, a sufficient condition for
the inequality to become true is <span class="math display">\[
     \begin{aligned}
         c^T      &amp; \le (y^T A + \bar y^T B + \hat y^T C) \\
         \bar c^T &amp; =   (y^T \bar A + \bar y^T \bar B + \hat y^T
\bar C) \\
         \hat c^T &amp; \ge (y^T \hat A + \bar y^T \hat B + \hat y^T
\hat C) \\
     \end{aligned}
\]</span></p>
<p>That gives the first set of constraints the dual variables <span
class="math inline">\(y\)</span>, <span class="math inline">\(\bar
y\)</span> and <span class="math inline">\(\hat y\)</span> need to
satisfies, respectively. We have just seen that the sign of the primal
variable determines the type of constraint in the dual.</p>
<p>Of particular interest is the inequality constraint, which we will
discuss in details in the next section.</p></li>
</ol>
<p>The rules of obtaining dual are summarized as follows:</p>
<blockquote>
<p><span class="math display">\[
\begin{array}{llll}    
\hline
\text{Primal} &amp; \max &amp; \min &amp;  \text{Dual} &amp; \\
\hline
\text{Constraints}  &amp;  
\begin{array}{l}
\le b_i \\
\ge b_i \\
= b_i  
\end{array} &amp;
\begin{array}{l}
\ge 0 \\
\le 0 \\
\text{Both sides}
\end{array} &amp;  
\text{Variables} &amp; \\
\hline
\text{Variables} &amp;
\begin{array}{l}
\ge 0 \\
\le 0 \\
\text{Both sides}
\end{array} &amp;
\begin{array}{l}
\ge c_j \\
\le c_i \\
= c_j   
\end{array} &amp;
\text{Constraints}  &amp; \\
\hline
\end{array}
\]</span></p>
</blockquote>
<h1 id="complementary-slackness">Complementary Slackness</h1>
<p>The strong duality states that, if both primal and dual are feasible,
then the objective function values of their optimal solutions are equal.
It follows that the inequalities in weak duality are saturated <span
class="math display">\[
    c^T x = (y^T A) x = y^T (Ax) = y^T b.
\]</span></p>
<p>Therefore, <span class="math display">\[
    (y^T A - c^T) x = 0,\,
    \\ y^T (b - Ax) = 0.
\]</span></p>
<p>If the primal is in canonical form, then the fact that <span
class="math inline">\(y^T A \ge c\)</span>, <span
class="math inline">\(x \ge 0\)</span>, <span class="math inline">\(y
\ge 0\)</span>, and <span class="math inline">\(b - Ax \ge 0\)</span>
implies that <span class="math display">\[
    \begin{matrix}
        (y^T A - c^T)_i = 0  &amp;\vee &amp; x_i =
0,\,         &amp;\forall \ i \in [n], \\
        y_j = 0             &amp;\vee  &amp; (b - Ax)_j =
0,\,  &amp;\forall \ j \in [m],
    \end{matrix}
\]</span></p>
<p>where <span class="math inline">\((y^T A - c^T)_i\)</span> is its
<span class="math inline">\(i\)</span>-th coordinate of the vector <span
class="math inline">\(y^T A - c^T \in \mathbb{R}^{1 \times n}\)</span>,
and <span class="math inline">\((b - Ax)_j\)</span> is the <span
class="math inline">\(j\)</span>-th coordinate of the vector <span
class="math inline">\(b - Ax \in \mathbb{R}^{m \times 1}\)</span>.</p>
<p>This is known as <strong><em>complementary
slackness</em></strong>.</p>
<blockquote>
<p><strong>Question to ponder</strong>: what is the geometric
interpretation of complementary slackness?</p>
</blockquote>
<!-- In what follows, we prove this again, by avoiding matrix form. 
First, weak duality implies 
$$
    \sum_{i = 1}^n c_i x_i \le \sum_{i = 1}^n \left( \sum_{j = 1}^m y_j A_{i, j} \right) x_i =  \sum_{j = 1}^m  y_j \left( \sum_{i = 1}^n A_{i, j} x_i \right) \le \sum_{j = 1}^m y_j b_j.
$$

If the inequalities are saturated, 
$$
    \sum_{i = 1}^n c_i x_i = \sum_{i = 1}^n \left( \sum_{j = 1}^m y_j A_{i, j}  \right) x_i,  \\  
    \sum_{j = 1}^m  y_j \left( \sum_{i = 1}^n A_{i, j} x_i \right)  = \sum_{j = 1}^m b_j y_j,
$$

i.e., 
$$
    \sum_{i = 1}^n \left( \sum_{j = 1}^m y_j A_{i, j} - c_i \right) x_i  = 0, \\  
    \sum_{j = 1}^m  y_j \left( b_j - \sum_{i = 1}^n A_{i, j} x_i \right) = 0.
$$

As $\sum_{j = 1}^m A_{i, j} y_j - c_i \ge 0$, $x_i \ge 0$ for all $i$ and $b_j - \sum_{i = 1}^n A_{i, j} x_i  \ge 0$ and $y_j \ge 0$ for all $j$, we conclude that 

$$
    \begin{array}{lrrr}
        \sum_{j = 1}^m y_j A_{i, j}  - c_i = 0 &\vee &    x_i = 0,\, & \forall i, \\ 
        b_j - \sum_{i = 1}^n A_{i, j} x_i = 0 &\vee &     y_j  = 0,\, & \forall j,
    \end{array}
$$ -->
<h1 id="strong-duality">Strong Duality</h1>
<blockquote>
<p><strong>Theorem.</strong> Exactly one of the following four cases
holds: 1. Neither the primal nor the dual is feasible.<br />
2. If both the primal and dual are feasible, then their optimal values
are equal. 3. If the primal is feasible and unbounded, and dual is
infeasible. 4. If the dual is feasible and unbounded, and primal is
infeasible.</p>
</blockquote>
<h2 id="special-case">Special Case</h2>
<p>We first consider the special case such that not every linear program
can be converted to this case. We consider the general form in the next
section.</p>
<p>The special case is given by <span class="math display">\[
    \begin{array}{lr}
        \min &amp; y^T b, \\
        \text{s.t. } &amp; y^T A = c^T.
    \end{array}
\]</span></p>
<p>The dual form is given by <span class="math display">\[
    \begin{array}{lr}
        \max &amp; c^T x, \\
        \text{s.t. } &amp; Ax = b.
    \end{array}
\]</span></p>
<p>The primal is feasible if <span class="math inline">\(c\)</span> is a
linear combination of rows of <span class="math inline">\(A\)</span>,
i.e., in the row space of <span class="math inline">\(A\)</span>. The
dual is feasible if <span class="math inline">\(b\)</span> is a linear
combination of columns of <span class="math inline">\(A\)</span>, i.e.,
in column space of <span class="math inline">\(A\)</span>, denoted as
<span class="math inline">\(C(A)\)</span>.</p>
<p>It is possible that neither the primal nor the dual is feasible.</p>
<blockquote>
<p><strong>Example.</strong> <span class="math display">\[
A = \begin{bmatrix}
1,\,    &amp;0\\
0,\,    &amp;0\\
\end{bmatrix},\,
b=  \begin{bmatrix}
1 \\
1 \\
\end{bmatrix},\,
c=  \begin{bmatrix}
1 \\
1 \\
\end{bmatrix}.
\]</span> Then neither <span class="math inline">\(A x = b\)</span> nor
<span class="math inline">\(y^T A = c^T\)</span> is feasible.</p>
</blockquote>
<p>If both primal and dual are feasible, then for all feasible solutions
<span class="math inline">\(x\)</span> and <span
class="math inline">\(y\)</span>, it holds that <span
class="math display">\[
    c^T x = (y^T A) x = y^T (Ax) = y^T b.
\]</span></p>
<p>Next, we show that</p>
<blockquote>
<p><strong>Theorem.</strong> 1. If the primal is feasible and dual is
infeasible, then the primal is unbounded. 2. If the dual is feasible and
primal is infeasible, then the dual is unbounded.</p>
</blockquote>
<p><strong>Proof.</strong> By symmetry, we prove just the former.</p>
<p>If <span class="math inline">\(Ax = b\)</span> is not feasible, then
<span class="math inline">\(b\)</span> lies outside the column space of
<span class="math inline">\(A\)</span>, denoted as <span
class="math inline">\(C(A)\)</span> (the subspace in <span
class="math inline">\(\mathbb{R}^m\)</span> spanned by the column
vectors of <span class="math inline">\(A\)</span>). Let <span
class="math inline">\(N(A^T)\)</span> be the subspace orthogonal to
<span class="math inline">\(C(A)\)</span>. We can decompose <span
class="math inline">\(b\)</span> into two part: <span
class="math display">\[
    b = b_1 + b_2,
\]</span></p>
<p>where <span class="math inline">\(b_1 \in C(A)\)</span> is in the
columns space of <span class="math inline">\(A\)</span> and <span
class="math inline">\(b_2 \in N(A^T)\)</span> is orthogonal to the
columns space of <span class="math inline">\(A\)</span>. By assumption
we have <span class="math inline">\(b_2 \neq \vec 0\)</span>.</p>
<p>Suppose <span class="math inline">\(y\)</span> is a feasible solution
to <span class="math inline">\(y^T A = c^T\)</span>. Then for all <span
class="math inline">\(k \in \mathbb{R}\)</span>, <span
class="math inline">\(y + k \cdot b_2\)</span> is still a feasible
solution, since <span class="math display">\[
    (y + k \cdot b_2)^T A = y^T A + k \cdot b_2^T A = y^T A = c^T.
\]</span></p>
<p>The new solution has objective <span class="math display">\[
    (y + k \cdot b_2)^T b = y^T b + k \cdot \Vert b_2 \Vert_2^2.
\]</span></p>
<p>When <span class="math inline">\(k \rightarrow - \infty\)</span>, we
have <span class="math inline">\(y^T b + k \cdot \Vert b_2 \Vert_2^2
\rightarrow - \infty\)</span>, which implies that the primal is
unbounded.</p>
<p><img
src="https://github.com/wuhao-wu-jiang/BlogImgs/raw/master/StrongDualitySpecialCase.jpg" /></p>
<h2 id="general-case">General Case</h2>
<p>We discuss the more general form: <span class="math display">\[
    \begin{array}{lr}
        \min &amp; y^T b, \\
        \text{s.t. } &amp; y^T A \ge c^T.
    \end{array}
\]</span></p>
<p>Every linear program can be converted into this general form.</p>
<p>Its dual is given by <span class="math display">\[
    \begin{array}{lr}
        \max &amp; c^T x, \\
        \text{s.t. } &amp; Ax = b, \\
        &amp; x \ge 0.
    \end{array}
\]</span></p>
<p>By weak duality, <span class="math display">\[
    c^T x \le y^T A x = y^T b
\]</span></p>
<p>To prove strong duality, we need only to prove that</p>
<blockquote>
<p>If both primal and dual are feasible, then there exists feasible
<span class="math inline">\(x, y\)</span>, such that <span
class="math inline">\(c^T x = y^T A x\)</span>.</p>
</blockquote>
<p>Define the feasible set of the primal as <span
class="math display">\[
    F \doteq \{ y \in \mathbb{R}^m : y^T A \ge c^T \}.  
\]</span></p>
<p>Let <span class="math inline">\(y^\star\)</span> be the optimal
solution for the primal. We see that <span
class="math inline">\(y^\star\)</span> can not be an interior point of
the feasible set <span class="math inline">\(F\)</span>. Otherwise, for
small enough <span class="math inline">\(k &gt; 0\)</span>, <span
class="math inline">\(y^\star - k \cdot b\)</span> belongs to <span
class="math inline">\(F\)</span>. But <span
class="math inline">\((y^\star - k \cdot b)^T b &lt; y^\star b\)</span>,
contradicting <span class="math inline">\(y^\star\)</span> being
optimal.</p>
<p>Therefore, <span class="math inline">\(y^\star\)</span> must be on
the boundary of the <span class="math inline">\(F\)</span>, and there
must exit one or more constraints saturated by <span
class="math inline">\(y^\star\)</span>. Define the set of indexes of the
constraints that are saturated by <span
class="math inline">\(y^\star\)</span> <span class="math display">\[
    S \doteq \{ i \in [m] : (y^\star)^T A_i = c_i \} \subseteq [m],
\]</span></p>
<p>where <span class="math inline">\(A_i\)</span> is the <span
class="math inline">\(i\)</span>-th column of matrix <span
class="math inline">\(A\)</span> and <span
class="math inline">\(c_i\)</span> is the <span
class="math inline">\(i\)</span>-th coordinator of vector <span
class="math inline">\(c\)</span>. Let <span
class="math inline">\(A_S\)</span> be set of columns indexed by <span
class="math inline">\(S\)</span>.</p>
<blockquote>
<p><strong>Lemma.</strong> <span class="math inline">\(b\)</span> is in
the conic hull of columns of <span class="math inline">\(A_S\)</span>,
i.e., <span class="math inline">\(\exists x_S \in R^{|S|}\)</span>, such
that<br />
1. <span class="math inline">\(A_S x_S = b\)</span>.<br />
2. <span class="math inline">\(x_S \ge 0\)</span>.</p>
</blockquote>
<p>Such <span class="math inline">\(x_S\)</span> can be converted into a
feasible solution <span class="math inline">\(x\)</span> to the dual (by
padding zeros in dimensions other than <span
class="math inline">\(S\)</span>). It holds that <span
class="math display">\[
    c^T x = (y^\star)^T A x = (y^\star)^T (A_S x_S ) = (y^\star)^T b.
\]</span></p>
<blockquote>
<p><strong>Question to ponder</strong>: prove the existence of optimal
solution of the primal, assuming feasibility of the dual.</p>
</blockquote>
<p><img
src="https://github.com/wuhao-wu-jiang/BlogImgs/raw/master/MinimizeYB.png" /></p>
<p><strong>Proof.</strong> We prove that if <span
class="math inline">\(b\)</span> is not in the conic hull of <span
class="math inline">\(A_S\)</span>, we can more <span
class="math inline">\(y^\star\)</span> along some direction that
decreases objective while maintaining feasibility.</p>
<p>By <a
target="_blank" rel="noopener" href="https://wuhao-wu-jiang.github.io/2019/01/17/Farkas-Lemma/">Farkas'
Lemma</a>, if <span class="math inline">\(b\)</span> is not in the conic
hull of <span class="math inline">\(A_S\)</span>, <span
class="math inline">\(\exists v \in \mathbb{R}^m\)</span>, such that</p>
<ol type="1">
<li><span class="math inline">\(v^T A_S \ge 0\)</span>.</li>
<li><span class="math inline">\(v^T b &lt; 0\)</span>.</li>
</ol>
<p><img
src="https://github.com/wuhao-wu-jiang/BlogImgs/raw/master/FarkasLemma3.png" /></p>
<p>Then we can move the vector <span
class="math inline">\(y^\star\)</span> along the direction of <span
class="math inline">\(v\)</span>, by adding <span
class="math inline">\(k \cdot v\)</span> to <span
class="math inline">\(y^\star\)</span> for some <span
class="math inline">\(k \ge 0\)</span>. This decreases the objective
<span class="math display">\[
    (y^\star + k \cdot v)^T b = (y^\star)^T b + k \cdot v^T b &lt;
(y^\star)^T b.
\]</span></p>
<p>How large can <span class="math inline">\(k\)</span> be, so the
constraints <span class="math inline">\((y^\star + k \cdot v)^T A \ge
c^T\)</span> are maintained.</p>
<ol type="1">
<li><p>If <span class="math inline">\(i \in \bar S\)</span>, then <span
class="math inline">\((y^\star)^T A_i &gt; c_i\)</span>. Define <span
class="math display">\[
     t_i \doteq \begin{cases}
         \infty,\, &amp;\text{if }\, v^T A_i \ge 0, \\
         \Big( (y^\star)^T A_i - c_i \Big) / \big| v^T A_i \big|,\,
&amp;\text{if }\, v^T A_i &lt; 0, \\
     \end{cases}
\]</span> Then <span class="math inline">\(t_i &gt; 0\)</span> and it is
guaranteed that <span class="math display">\[
     (y^\star)^T A_i + t_i \cdot v \ge c_i.
\]</span> Denote <span class="math inline">\(k \doteq \min_{i \in \bar
S} t_i &gt; 0\)</span>.</p></li>
<li><p>If <span class="math inline">\(i \in S\)</span>, as <span
class="math inline">\(v^T A_i \ge 0\)</span>, for the value of <span
class="math inline">\(k\)</span> defined above, it holds that <span
class="math display">\[
     (y^\star + k v)^T A_i = c_i + k v^T A_i \ge c_i,
\]</span></p></li>
</ol>
<p>It concludes that <span class="math inline">\((y^\star + k
v)\)</span> is feasible. But <span class="math inline">\((y^\star + k
v)^T b &lt; (y^\star)^T b\)</span>. A contradiction.</p>
<blockquote>
<p><strong>Question to ponder</strong>: connect the above discussion to
Lagrange multiplier and <a
target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Karush%E2%80%93Kuhn%E2%80%93Tucker_conditions">K.K.T
condition</a>.</p>
</blockquote>
<h1 id="reference.">Reference.</h1>
<ol type="1">
<li>David P. Williamson, ORIE 6300 Mathematical Programming I, <a
target="_blank" rel="noopener" href="https://people.orie.cornell.edu/dpw/orie6300/Lectures/lec08.pdf">Lecture
8</a><br />
</li>
<li>Boyd, S. and Vandenberghe, L., 2004. Convex optimization. Cambridge
university press.</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/14/Sparse-Recovery-with-Count-Sketch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="WOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WOW">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/14/Sparse-Recovery-with-Count-Sketch/" class="post-title-link" itemprop="url">Sparse Recovery with Count-Sketch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-14 06:51:28" itemprop="dateCreated datePublished" datetime="2020-01-14T06:51:28-05:00">2020-01-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-08 23:40:52" itemprop="dateModified" datetime="2021-04-08T23:40:52-04:00">2021-04-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="background">Background</h1>
<p>A stream of items <span class="math inline">\(S = \{ a_1, a_2, ...,
a_m \}\)</span> where <span class="math inline">\(a_i \in [n]\)</span>.
Let the frequencies of elements in <span
class="math inline">\([n]\)</span> be <span class="math inline">\(f =
\left&lt; f_1, f_2, ..., f_n \right&gt;\)</span>, where <span
class="math inline">\(f_j = |\{ a_i \in S : a_i = j \}|\)</span>.</p>
<h2 id="count-sketch">Count-Sketch</h2>
<p>It returns an estimation <span class="math inline">\(\hat f\)</span>
of <span class="math inline">\(f\)</span> with space <span
class="math inline">\(O(\frac{1}{\epsilon^2} \log n)\)</span> words,
such that with probability at least <span class="math inline">\(1 - 1 /
n\)</span>, for every <span class="math inline">\(i \in [n]\)</span>,
<span class="math display">\[
    |\hat f_i - f_i| \le \epsilon \Vert f \Vert_2,
\]</span> where <span class="math inline">\(\Vert f \Vert_2 = \sqrt
{\sum_{i = 1}^n f_i^2 }\)</span>.</p>
<h1 id="problem">Problem</h1>
<p>In general, a sketch is a concise representation of <span
class="math inline">\(f\)</span>. Suppose that we limit our space usage
to <span class="math inline">\(k\)</span> words (i.e., <span
class="math inline">\(\Vert \hat f \Vert_0 = k\)</span>). Then the
sketch <span class="math inline">\(\hat f\)</span> that minimizes the
<span class="math inline">\(\ell_2\)</span> error <span
class="math display">\[
    err_2^k (f) \doteq \Vert f - \hat f \Vert_2
\]</span></p>
<p>keeps the set <span class="math inline">\(H\)</span> of <span
class="math inline">\(k\)</span> items with highest frequencies. In such
case, the error is given by <span class="math display">\[
    err_2^k (f) = \sqrt {\sum_{i \notin H} f_i^2}
\]</span></p>
<p>In practice, however, <span class="math inline">\(S\)</span> is not
given offline. As we don't know <span class="math inline">\(H\)</span>,
we can only compute an <span class="math inline">\(\hat f\)</span> with
<span class="math inline">\(k\)</span> words that is as good as
possible. The question is, how far <span class="math inline">\(\Vert f -
\hat f \Vert_2\)</span> can be from the minimum possible value, namely
<span class="math inline">\(err_2^k(f)\)</span>?</p>
<h1 id="algorithm">Algorithm</h1>
<p>One possible solution, proposed by Cormode and Muthukrishnan [1], is
to construct <span class="math inline">\(\hat f\)</span> vis
Count-Sketch. In particular,</p>
<ol type="1">
<li>It uses <span class="math inline">\(d = O(\log n)\)</span> hash
tables.<br />
</li>
<li>Each hash table has size <span class="math inline">\(w =
\frac{3k}{\epsilon^2}\)</span>.</li>
</ol>
<h2 id="frequency-oracle-error">Frequency Oracle Error</h2>
<blockquote>
<p><strong>Lemma 1.</strong> For every <span class="math inline">\(i \in
[n]\)</span>, with probability <span class="math inline">\(1 - 1
/n^2\)</span>, <span class="math display">\[
|f_i - \hat f_i| \le \frac{\epsilon}{\sqrt k } err_2^k(f).
\]</span></p>
</blockquote>
<p><strong>Remark:</strong> <em>If <span
class="math inline">\(f\)</span> is <span
class="math inline">\(k\)</span> sparse, i.e., the number of non-zero
elements of <span class="math inline">\(f\)</span> is at most <span
class="math inline">\(k\)</span>, then <span
class="math inline">\(err_2^k(f) = 0\)</span> and the algorithm recovers
<span class="math inline">\(f\)</span> exactly.</em></p>
<p><strong>Proof:</strong> Consider a fixed <span
class="math inline">\(t \in [k]\)</span>. For <span
class="math inline">\(i \in [n]\)</span>, let <span
class="math inline">\(h_t(i)\)</span> the bucket of item <span
class="math inline">\(i\)</span> in the <span
class="math inline">\(t\)</span>-th hash table. Define <span
class="math display">\[
    A_i : \exist x \in H, \text{ s.t. } h_j(x) = h_j(i),
\]</span> be the event such that some heavy item collides with <span
class="math inline">\(i\)</span> in the <span
class="math inline">\(t\)</span>-th table. Then by union bound, <span
class="math display">\[
    \Pr[A_i] \le \frac{k}{w} = \frac{\epsilon^2}{3}.
\]</span></p>
<p>Therefore, by the law of total probability and monotonicity of
probability, we have <span class="math display">\[
\begin{aligned}
    \Pr \left[ |f_i - h_i(j)| \ge \frac{\epsilon}{\sqrt k } err_2^k(f)
\right]
        &amp;\le \Pr[A_i] + \Pr \left[ |f_i - h_i(j) |
\ge  \frac{\epsilon}{\sqrt k } err_2^k(f) \mid \bar A_i \right] \\
        &amp;\le \Pr[A_i] + \frac{ \mathbb{Var} [ f_i - h_i(j)  \mid
\bar A_i ] }{ (\frac{\epsilon}{\sqrt k } err_2^k(f) )^2 } \\
        &amp;\le \frac{\epsilon^2}{3} + \frac{(err_2^k(f))^2 / w }{
(\frac{\epsilon}{\sqrt k } err_2^k(f) )^2 } \\
        &amp;\le \frac{\epsilon^2}{3} + \frac{1}{3}
\end{aligned}
\]</span></p>
<p>As long as <span class="math inline">\(\epsilon^2 / 3 &lt; 1 /
6\)</span>, this probability is smaller than <span
class="math inline">\(1 / 2\)</span>. We can boost the failure
probability to <span class="math inline">\(1/ n^2\)</span> by repeating
the hash tables <span class="math inline">\(d = O(\log n)\)</span> times
and taking the median as estimation.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<h2 id="sparse-vector-construction">Sparse Vector Construction</h2>
<p>The next step is keep only set <span class="math inline">\(\hat
H\)</span> of the <span class="math inline">\(k\)</span> largest items
in <span class="math inline">\(\hat f\)</span>. Note that <span
class="math inline">\(\hat H\)</span> might not equals to <span
class="math inline">\(H\)</span>. To bound the value <span
class="math inline">\(\Vert f - \hat f \Vert_2\)</span>, we partition
<span class="math inline">\([n]\)</span> into three parts: <span
class="math display">\[
    \hat H, \quad H \setminus \hat H, \quad [n] \setminus (H \cup \hat
H).
\]</span></p>
<blockquote>
<p><strong>Lemma 2</strong>. <span class="math inline">\(\sum_{i \in
\hat H} (f_i - \hat f_i)^2 \le \epsilon^2 (err_2^k(f))^2\)</span>.</p>
</blockquote>
<p><strong>Proof.</strong> By lemma 1, each term <span
class="math inline">\((f_i - \hat f_i)^2\)</span> has error at most
<span class="math inline">\(\frac{\epsilon^2}{k}
(err_2^k(f))^2\)</span>. The claim then follows from that <span
class="math inline">\(|\hat H| = k\)</span>.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<blockquote>
<p><strong>Lemma 3</strong>. <span class="math inline">\(\sum_{i \in H
\setminus \hat H} f_i ^2 \le \sum_{j \in \hat H \setminus H} \hat f_j^2
+ (2 \epsilon + \epsilon^2) ( err_2^k(f))^2\)</span></p>
</blockquote>
<p><strong>Proof.</strong> <span class="math inline">\(|H| = |\hat
H|\)</span>, we have <span class="math inline">\(|H \setminus \hat H| =
|\hat H \setminus H|\)</span>.</p>
<p>If <span class="math inline">\(H \setminus \hat H =
\emptyset\)</span>, the claim is trivial. Otherwise, we can construct a
bijection between <span class="math inline">\(H \setminus \hat
H\)</span> and <span class="math inline">\(\hat H \setminus H\)</span>.
Then for <span class="math inline">\(i \in H \setminus \hat H\)</span>,
let <span class="math inline">\(j\)</span> be its corresponding index in
<span class="math inline">\(\hat H \setminus H\)</span>. Then</p>
<p><span class="math display">\[
\begin{aligned}
    f_j &amp;= (f_j - \hat f_j) + (\hat f_j - \hat f_i) + (\hat f_i -
f_i) + f_i \\
        &amp;\ge - \frac{\epsilon}{\sqrt k } err_2^k(f) + 0 -
\frac{\epsilon}{\sqrt k } err_2^k(f) + f_i
\end{aligned}
\]</span></p>
<p>Therefore, <span class="math display">\[
    f_i \le f_j + \frac{2\epsilon}{\sqrt k } err_2^k(f)
\]</span></p>
<p>and <span class="math display">\[
\begin{aligned}
    \sum_{i \in H \setminus \hat H} f_i^2       
        &amp;\le \sum_{j \in \hat H \setminus H} f_j^2 + \frac{4
\epsilon}{\sqrt k } \left( \sum_{j \in \hat H \setminus H} f_j\right) +
4 \epsilon^2 (err_2^k(f))^2 \\
        &amp;\le \sum_{j \in \hat H \setminus H} f_j^2 + \frac{4
\epsilon}{\sqrt k } err_2^k(f) \left( \sum_{j \in \hat H \setminus H}
f_j\right) + 4 \epsilon^2 (err_2^k(f))^2 \\
        &amp;\le \sum_{j \in \hat H \setminus H} f_j^2 + \frac{4
\epsilon}{\sqrt k } err_2^k(f) \left( k \sqrt{ \frac{1}{k} \sum_{j \in
\hat H \setminus H} f_j^2 } \right) + 4 \epsilon^2 (err_2^k(f))^2 \\
        &amp;= \sum_{j \in \hat H \setminus H} f_j^2 + 4 \epsilon
(err_2^k(f))^2 + 4 \epsilon^2 (err_2^k(f))^2 \\
        &amp;= \sum_{j \in \hat H \setminus H} f_j^2 + (4 \epsilon + 4
\epsilon^2) (err_2^k(f))^2
\end{aligned}
\]</span></p>
<!-- $$
    f_i = f_i - \hat f_i + \hat f_i - \hat f_j + \hat f_j
$$ -->
<!-- As $\hat H$ contains the largest $k$ items in $\hat f$, it must be that $\hat f_i - \hat f_j \le 0$. Therefore, 

$$
f_i \le f_i - \hat f_i + \hat f_j
$$

By lemma 1, we have $f_i - \hat f_i \le \frac{\epsilon}{\sqrt k } err_2^k(f)$, we have 

$$
f_i \le \frac{\epsilon}{\sqrt k } err_2^k(f) + \hat f_j
$$

Summing over all possible $i$, 

$$
\begin{aligned}
    \sum_{i \in H \setminus \hat H} f_i ^2 
    &\le \sum_{j \in \hat H \setminus H} (\frac{\epsilon}{\sqrt k } err_2^k(f) + \hat f_j)^2 \\
    &= \sum_{j \in \hat H \setminus H} \hat f_j^2  + 2 \left( \sum_{j \in \hat H \setminus H} \hat f_j \right) \frac{\epsilon}{\sqrt k } err_2^k(f) +  \epsilon^2 ( err_2^k(f))^2 \\
    &\le \sum_{j \in \hat H \setminus H} \hat f_j^2  + 2 k \sqrt{ \sum_{j \in \hat H \setminus H} \frac{1}{k} \hat f_j^2} \frac{\epsilon}{\sqrt k } err_2^k(f) +  \epsilon^2 ( err_2^k(f))^2 \\
    &= \sum_{j \in \hat H \setminus H} \hat f_j^2  + 2 \epsilon (err_2^k(f)) \sqrt{ \sum_{j \in \hat H \setminus H} \hat f_j^2} +  \epsilon^2 ( err_2^k(f))^2 \\
    &\le \sum_{j \in \hat H \setminus H} \hat f_j^2  + (2 \epsilon +  \epsilon^2) ( err_2^k(f))^2. 
\end{aligned}
$$ -->
<p><span class="math inline">\(\square\)</span></p>
<h2 id="reference">Reference</h2>
<p>[1] G. Cormode and S. Muthukrishnan. Combinatorial algorithms for
Compressed Sensing.<br />
[2] Moses Charikar, Lecture 9, CS 369G: Algorithmic Techniques for Big
Data</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/11/Priority-Sampling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="WOW">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WOW">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/11/Priority-Sampling/" class="post-title-link" itemprop="url">Priority Sampling</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-11 22:32:57" itemprop="dateCreated datePublished" datetime="2020-01-11T22:32:57-05:00">2020-01-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-24 01:07:43" itemprop="dateModified" datetime="2021-02-24T01:07:43-05:00">2021-02-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Suppose there are a set of <span class="math inline">\(n\)</span>
items with nonnegative weights <span class="math inline">\(w_1, w_2,
..., w_n\)</span>. We want to maintain a subset of samples <span
class="math inline">\(S \subset [n]\)</span> in order to answer queries
like given arbitrary <span class="math inline">\(I \subset [n]\)</span>
, what is <span class="math inline">\(\sum_{i \in I} w_i\)</span>?</p>
<p>A trivial solution is to set <span class="math inline">\(S =
[n]\)</span> and we can answer the query exactly. This is an overkill if
our goal is to only answer the query approximately.</p>
<p>Alternatively, we can sample each item <span class="math inline">\(i
\in [n]\)</span> independently with probability <span
class="math inline">\(p_i\)</span> (to be determined), and maintain a
random variable <span class="math display">\[
\begin{aligned}
X_i =
    \begin{cases}
        \frac{w_i}{p_i} &amp; i \text{ is chosen} \\
        0               &amp;   \text{ else }
    \end{cases}
\end{aligned}
\]</span></p>
<p>Note that <span class="math display">\[
\mathbb{E} \left[ X_i \right] = w_i
\]</span></p>
<p>And therefore, <span class="math display">\[
\mathbb{E} \left[\sum_{i \in I} X_i \right] = \sum_{i \in I}
\mathbb{E}[X_i] = \sum_{i \in I} w_i
\]</span></p>
<h1 id="threshold-sampling">Threshold Sampling</h1>
<p>One possible implementation of this sampling scheme is called
<em>threshold sampling</em>.</p>
<p>First, a threshold <span class="math inline">\(T\)</span> is chosen.
Then, for each item <span class="math inline">\(i \in [n]\)</span>, if
<span class="math inline">\(w_i \ge T\)</span>, then the algorithm
record a value <span class="math inline">\(X_i = w_i\)</span>
deterministically. Otherwise, the algorithm record a value <span
class="math inline">\(X_i = T\)</span> with probability <span
class="math inline">\(\frac{w_i}{T}\)</span>. If <span
class="math inline">\(X_i\)</span> is not recorded, it has default value
<span class="math inline">\(0\)</span>. In both cases, <span
class="math inline">\(\mathbb{E} [ X_i ] = w_i\)</span>.</p>
<!-- $\forall i \in [n]$, $w_i$ is kept with probability with $p_i = \min \{ 1 , \frac{w_i}{T} \}$. In particular, for each $i \in [n]$, we sample a uniform random variable $u_i \in [0, 1]$, and set  -->
<p>Mathematically, the two cases can be combined into one. Let <span
class="math inline">\(u_i\)</span> be a random number generated between
<span class="math inline">\((0, 1)\)</span>. Then</p>
<p><span class="math display">\[
\begin{aligned}
X_i =
    \begin{cases}
        \max \{ w_i, T \} &amp; u_i &lt; \frac{w_i}{T} \\
        0               &amp;   \text{ else }
    \end{cases}
\end{aligned}
\]</span></p>
<p>Observe that if <span class="math inline">\(w_i \ge T\)</span>, then
<span class="math inline">\(w_i / T \ge 1\)</span> and <span
class="math inline">\(X_i \equiv \max \{ w_i, T \} = w_i\)</span>. The
expectation of <span class="math inline">\(X_i\)</span> is given
algebraically by <span class="math display">\[
\begin{aligned}
    \mathbb{E} [ X_i ] = \max \{ w_i, T \} \cdot \Pr \left[ u_i \le
\frac{w_i}{T} \right] = \max \{ w_i, T \} \cdot \min \{ 1, w_i / T \} =
w_i.
\end{aligned}
\]</span></p>
<p>It follows by linearity of expectation that <span
class="math display">\[
    \mathbb{E} \left[ \sum_{i \in I} X_i \right] = \sum_{i \in I} w_i.
\]</span></p>
<h2 id="space-usage">Space Usage</h2>
<p>Denote <span class="math inline">\(S\)</span> the set of items with
<span class="math inline">\(X_i \neq 0\)</span> and let <span
class="math inline">\(p_i\)</span> be the probability of <span
class="math inline">\(i\)</span> being sampled. Then the expected size
of <span class="math inline">\(S\)</span> is given by <span
class="math display">\[
\sum_{i = 1}^n p_i = \sum_{i = 1}^n \min \left\{ 1 , \frac{w_i}{T}
\right\}
\]</span></p>
<p>The problem with threshold sampling is that it is hard to control the
memory usage of the sample set <span class="math inline">\(S\)</span>.
If the <span class="math inline">\(n\)</span> items are known offline,
and we would like <span class="math inline">\(|S| \approx k\)</span> for
some integer <span class="math inline">\(k \le n\)</span>, then we can
search for some <span class="math inline">\(T\)</span> such that <span
class="math display">\[
\sum_{i = 1}^n p_i = k
\]</span></p>
<p>Then <span class="math inline">\(|S| = k\)</span> in expectation.</p>
<p>The question is, is it possible to force <span
class="math inline">\(|S|= k\)</span> exactly? Further, what if the
items come online (one by one)?</p>
<h1 id="priority-sampling">Priority Sampling</h1>
<p><em>Priority sampling</em> achieves this. First recall that in
<em>threshold sampling</em> we decide whether to keep <span
class="math inline">\(i\)</span> by checking whether a uniform sampled
real number <span class="math inline">\(u_i\)</span> is less than <span
class="math inline">\(\frac{w_i}{T}\)</span>: <span
class="math display">\[
u_i &lt; \frac{w_i}{T}
\]</span></p>
<p>This is equivalent to <span class="math display">\[
T &lt; \frac{w_i}{u_i}
\]</span></p>
<p>Define the <em>priority</em> of an item <span class="math inline">\(i
\in [n]\)</span> as <span class="math inline">\(q_i =
\frac{w_i}{u_i}\)</span>. Note that <span
class="math inline">\(q_i\)</span> is a random variable. In
<em>threshold sampling</em>, item <span class="math inline">\(i\)</span>
is kept with weight <span class="math inline">\(\max \{ w_i, T
\}\)</span> if <span class="math display">\[
T &lt; q_i
\]</span></p>
<p>Now, instead of using a fixed value of <span
class="math inline">\(T\)</span>, the <em>Priority sampling</em> sets
<span class="math display">\[
T = (k + 1) \text{-th largest } \{ q_i \}
\]</span></p>
<p>By the definition of <span class="math inline">\(T\)</span>, only the
<span class="math inline">\(k\)</span> items with largest priorities
<span class="math inline">\(q_i\)</span>'s are kept in the sample set
<span class="math inline">\(S\)</span>: <span class="math display">\[
S = \{ k \text{ items with largest } q_i \text{ &#39;s } \}
\]</span></p>
<p>It can be seen that <span class="math inline">\(S\)</span> and <span
class="math inline">\(T\)</span> can be easily maintained by a binary
heap when the items come in stream fashion.</p>
<p>The challenge is not to analyze the behaviors of the r.v.'s: <span
class="math display">\[
\begin{aligned}
X_i =
    \begin{cases}
        \max \{ w_i, T \} &amp; T &lt; \frac{w_i}{u_i} \equiv u_i &lt;
\frac{w_i}{T} \\
        0               &amp;   \text{ else }
    \end{cases}
\end{aligned}
\]</span></p>
<p>since now <span class="math inline">\(T\)</span> is itself a random
variable.</p>
<h2 id="theorem">Theorem</h2>
<p><span class="math display">\[
    \mathbb{E}[X_i] = w_i.
\]</span></p>
<p><em>Proof.</em> There is an elegant proof based on conditional
expectation. For <span class="math inline">\(i \in [n]\)</span>, define
the random variable <span class="math inline">\(T_i\)</span> as the
<span class="math inline">\(k\)</span>-th largest priority of elements
other than <span class="math inline">\(i\)</span>. If <span
class="math inline">\(i\)</span>-th is sampled, then <span
class="math inline">\(q_i \ge T_i\)</span> and <span
class="math inline">\(T_i\)</span> becomes the <span
class="math inline">\(k+1\)</span>-th largest priority. Therefore, <span
class="math display">\[
    \mathbb{E}_{X_i} [ X_i \mid T_i ] = \max \{ X_i, T_i \} \cdot \min
\{1, w_i / T_i \} = w_i.
\]</span></p>
<p>Finally, <span class="math inline">\(\mathbb{E}_{X_i} [X_i ] =
\mathbb{E}_{T_i} [ \mathbb{E}_{X_i} [ X_i \mid T_i] ] =
w_i\)</span>.</p>
<!-- The trick is to condition $X_i$ on the $k$-th and $k+1$-th largest priority of the rest items. Define the random variables 
$$
L = (k + 1) \text{-th largest } \{ q_j \}_{j \neq i} \\
U = (k) \text{-th largest } \{ q_j \}_{j \neq i}
$$

Consider the case $L = a$ and $U = b$, where $a \le b$. There two possible cases

1. If $w_i > b$, then $T = b$ and surely $\frac{w_i}{u_i} > T$ holds. In this case  $X_i = w_i$ and 
    $$
        \mathbb{E}[X_i | U = b] = w_i
    $$

2. If $w_i < b$, then there are four sub-cases:
   * $\frac{w_i}{u_i} \le a$, then $T = b$ and $i$ is not selected into $S$. Therefore $X_i = 0$.   
  
   * $a < \frac{w_i}{u_i} < b$, now $\frac{w_i}{u_i}$ becomes the $k+1$-th largest priority of all items and $T = \frac{w_i}{u_i}$. In this case $i$ is not selected into $S$, and $X_i = 0$ (since $\frac{w_i}{u_i} < T$ does not hold). 
  
   * $\frac{w_i}{u_i} = b$, then there is a tie and $T = b$ in this case. Depending on how the tie is broken, either $i$ is put into $S$ or not. But in both cases, $X_i = 0$ since $\frac{w_i}{u_i} < T$ does not hold. 
  
   * $\frac{w_i}{u_i} > b$, then $T = b$ and $i$ is put into $S$. As $w_i < T$, we have $X_i = T = b$. 

    Therefore, 
    $$
        \mathbb{E}[X_i | U = b] = b \cdot \Pr\left[ \frac{w_i}{u_i} > b \mid w_i < b \wedge U = b \right] = b \cdot \frac{w_i}{b} = w_i
    $$

In conclusion, 
$$
\mathbb{E}[X_i] = \mathbb{E}[\mathbb{E}[X_i | U]]  = w_i
$$ -->
<h2 id="theorem-1">Theorem</h2>
<p>For <span class="math inline">\(I \subset [n]\)</span>, <span
class="math display">\[
\begin{aligned}
    \mathbb{E}\left[ \prod_{i \in I} X_i \right] =
    \begin{cases}
         \prod_{i \in I} w_i     &amp; \text{ if } |I| \le k \\
         0                      &amp; else
    \end{cases}
\end{aligned}
\]</span></p>
<p><em>Proof:</em> Clearly, when <span class="math inline">\(|I| &gt;
k\)</span>, then <span class="math inline">\(\exists i \in I\)</span>,
such that <span class="math inline">\(q_i\)</span> is not one of the
<span class="math inline">\(k\)</span> largest priorities. Hence <span
class="math inline">\(\prod_{i \in I} X_i = 0\)</span> for sure.</p>
<p>If <span class="math inline">\(|I| \le k\)</span>, define <span
class="math inline">\(T_I\)</span> to be the <span
class="math inline">\(k - |I| + 1\)</span>-th largest priority of
elements in <span class="math inline">\([n] \setminus I\)</span>.
Observe that <span class="math inline">\(\prod_{i \in I} X_i \neq
0\)</span>, if only the priorities of all <span class="math inline">\(i
\in I\)</span> are among the <span class="math inline">\(k\)</span>
largest ones. In such case, <span class="math inline">\(T_I\)</span>
becomes the <span class="math inline">\(k+1\)</span>-th largest
priority. Therefore, <span class="math display">\[
    \mathbb{E} \left[ \prod_{i \in I} X_i \mid T_I \right] = \prod_{i
\in I} \mathbb{E} [ X_i \mid T_I ] = \prod_{i \in I} w_i,
\]</span></p>
<p>and <span class="math inline">\(\mathbb{E}[ \prod_{i \in I} X_i ] =
\mathbb{E} [ \mathbb{E} \left[ \prod_{i \in I} X_i \mid T_I \right] ] =
\prod_{i \in I} w_i\)</span>.</p>
<!-- If $|I| \le k$, we show the claims holds by induction. The base case of $|I| = 1$ reduces to *Theorem 1*. Suppose that the claim hold for $|I| \le t < k$, we show it holds for $|I| = t + 1$. 

Similarly to *Theorem 1*, define $U$ to be the $k + 1 - |I|$-th largest priority in $[n] \setminus I$. Conditioning on $U = b$, then we can divide $I$ into two sets: $I_1 = \{ i \in I :   w_i > b\}$ and $I_2 = I \setminus I_1$.  For $i \in I_1$, we have $X_i = w_i$ by definition. Now consider $I_2$. Let $j = \arg \min_{i \in I_2} q_i$. 
If $q_j \le b$, then it holds that $b \ge T \ge q_j$ and $X_j = 0$. In this case it does not contribute to $\prod_{i \in I} X_i$. Hence
$$
\begin{aligned}
\mathbb{E} \left[ \prod_{i \in I} X_i \mid U = b \right] 
    &= \prod_{i \in I_1} w_i ( b^{|I_2| } \cdot \prod_{i \in I_2} \Pr \left[ \frac{w_i}{u_i} > b \right] ) \\
    &= \prod_{i \in I_1} w_i ( b^{|I_2| } \cdot \prod_{i \in I_2} \frac{w_i}{b} ) \\
    &= \prod_{i \in I} w_i
\end{aligned}
$$ -->
<h3 id="reference">Reference</h3>
<ol type="1">
<li>Nick Duffield, Carsten Lund, and Mikkel Thorup. Priority sampling
for estimation fo arbitrary subset sums. Journal of ACM, 2007</li>
<li>Chandra Chekuri, Lecture note, CS 598: Algorithms for Big Data</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/40/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/40/">40</a><span class="page-number current">41</span><a class="page-number" href="/page/42/">42</a><span class="space">&hellip;</span><a class="page-number" href="/page/66/">66</a><a class="extend next" rel="next" href="/page/42/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">WOW</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">196</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WOW</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
